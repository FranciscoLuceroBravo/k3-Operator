

# This file was *autogenerated* from the file k3_mes.sage
from sage.all_cmdline import *   # import sage library

_sage_const_5 = Integer(5); _sage_const_6 = Integer(6); _sage_const_7 = Integer(7); _sage_const_13 = Integer(13); _sage_const_14 = Integer(14); _sage_const_15 = Integer(15); _sage_const_20 = Integer(20); _sage_const_21 = Integer(21); _sage_const_22 = Integer(22); _sage_const_23 = Integer(23); _sage_const_29 = Integer(29); _sage_const_30 = Integer(30); _sage_const_31 = Integer(31); _sage_const_34 = Integer(34); _sage_const_37 = Integer(37); _sage_const_38 = Integer(38); _sage_const_39 = Integer(39); _sage_const_41 = Integer(41); _sage_const_46 = Integer(46); _sage_const_47 = Integer(47); _sage_const_52 = Integer(52); _sage_const_53 = Integer(53); _sage_const_54 = Integer(54); _sage_const_55 = Integer(55); _sage_const_60 = Integer(60); _sage_const_61 = Integer(61); _sage_const_62 = Integer(62); _sage_const_63 = Integer(63); _sage_const_65 = Integer(65); _sage_const_69 = Integer(69); _sage_const_70 = Integer(70); _sage_const_71 = Integer(71); _sage_const_77 = Integer(77); _sage_const_78 = Integer(78); _sage_const_79 = Integer(79); _sage_const_80 = Integer(80); _sage_const_84 = Integer(84); _sage_const_85 = Integer(85); _sage_const_86 = Integer(86); _sage_const_87 = Integer(87); _sage_const_92 = Integer(92); _sage_const_93 = Integer(93); _sage_const_94 = Integer(94); _sage_const_95 = Integer(95); _sage_const_101 = Integer(101); _sage_const_102 = Integer(102); _sage_const_103 = Integer(103); _sage_const_109 = Integer(109); _sage_const_110 = Integer(110); _sage_const_111 = Integer(111); _sage_const_117 = Integer(117); _sage_const_118 = Integer(118); _sage_const_119 = Integer(119); _sage_const_120 = Integer(120); _sage_const_125 = Integer(125); _sage_const_126 = Integer(126); _sage_const_127 = Integer(127); _sage_const_133 = Integer(133); _sage_const_134 = Integer(134); _sage_const_135 = Integer(135); _sage_const_138 = Integer(138); _sage_const_141 = Integer(141); _sage_const_142 = Integer(142); _sage_const_143 = Integer(143); _sage_const_145 = Integer(145); _sage_const_149 = Integer(149); _sage_const_150 = Integer(150); _sage_const_151 = Integer(151); _sage_const_154 = Integer(154); _sage_const_157 = Integer(157); _sage_const_158 = Integer(158); _sage_const_159 = Integer(159); _sage_const_161 = Integer(161); _sage_const_164 = Integer(164); _sage_const_165 = Integer(165); _sage_const_166 = Integer(166); _sage_const_167 = Integer(167); _sage_const_173 = Integer(173); _sage_const_174 = Integer(174); _sage_const_175 = Integer(175); _sage_const_181 = Integer(181); _sage_const_182 = Integer(182); _sage_const_183 = Integer(183); _sage_const_188 = Integer(188); _sage_const_190 = Integer(190); _sage_const_191 = Integer(191); _sage_const_194 = Integer(194); _sage_const_197 = Integer(197); _sage_const_198 = Integer(198); _sage_const_199 = Integer(199); _sage_const_210 = Integer(210); _sage_const_10000 = Integer(10000); _sage_const_1 = Integer(1); _sage_const_100 = Integer(100); _sage_const_0 = Integer(0); _sage_const_2 = Integer(2); _sage_const_3 = Integer(3)
from sage.all import *
import csv
import sys
import time
import os

def obtener_oeis_91():
    return [_sage_const_5 , _sage_const_6 , _sage_const_7 , _sage_const_13 , _sage_const_14 , _sage_const_15 , _sage_const_20 , _sage_const_21 , _sage_const_22 , _sage_const_23 , _sage_const_29 , _sage_const_30 , _sage_const_31 , _sage_const_34 , _sage_const_37 , _sage_const_38 , _sage_const_39 , _sage_const_41 , _sage_const_46 , _sage_const_47 , 
            _sage_const_52 , _sage_const_53 , _sage_const_54 , _sage_const_55 , _sage_const_60 , _sage_const_61 , _sage_const_62 , _sage_const_63 , _sage_const_65 , _sage_const_69 , _sage_const_70 , _sage_const_71 , _sage_const_77 , _sage_const_78 , _sage_const_79 , _sage_const_80 , _sage_const_84 , _sage_const_85 , _sage_const_86 , _sage_const_87 , 
            _sage_const_92 , _sage_const_93 , _sage_const_94 , _sage_const_95 , _sage_const_101 , _sage_const_102 , _sage_const_103 , _sage_const_109 , _sage_const_110 , _sage_const_111 , _sage_const_117 , _sage_const_118 , _sage_const_119 , _sage_const_120 , _sage_const_125 , _sage_const_126 , _sage_const_127 , 
            _sage_const_133 , _sage_const_134 , _sage_const_135 , _sage_const_138 , _sage_const_141 , _sage_const_142 , _sage_const_143 , _sage_const_145 , _sage_const_149 , _sage_const_150 , _sage_const_151 , _sage_const_154 , _sage_const_157 , _sage_const_158 , _sage_const_159 , _sage_const_161 , 
            _sage_const_164 , _sage_const_165 , _sage_const_166 , _sage_const_167 , _sage_const_173 , _sage_const_174 , _sage_const_175 , _sage_const_181 , _sage_const_182 , _sage_const_183 , _sage_const_188 , _sage_const_190 , _sage_const_191 , _sage_const_194 , _sage_const_197 , _sage_const_198 , _sage_const_199 , _sage_const_210 ]

def barrido_gigante_k3_resistente(max_n=_sage_const_10000 ):
    oeis_91 = set(obtener_oeis_91())
    db_hallazgos = set() # Solo guardamos N para ahorrar RAM
    encontrados_oeis = set()
    ratios_hallados = [] # Para estadística final
    archivo_csv = 'db_k3_gigante_ratio_autosave.csv'
    
    # Escribir encabezado si el archivo es nuevo
    if not os.path.exists(archivo_csv):
        with open(archivo_csv, 'w', newline='') as f:
            writer = csv.writer(f)
            writer.writerow(['N', 'n', 'm', 'Ratio_m_n', 'Es_OEIS_91'])

    start_time = time.time()
    print(f"--- BARRIDO k=3 (MODO RESISTENTE) | n=[1..{max_n}] ---")

    # Abrir archivo en modo append con flush automático
    with open(archivo_csv, 'a', newline='', buffering=_sage_const_1 ) as f:
        writer = csv.writer(f)
        
        for n in range(_sage_const_1 , max_n + _sage_const_1 ):
            # Monitoreo cada 100 n
            if n % _sage_const_100  == _sage_const_0 :
                elapsed = time.time() - start_time
                print(f"Progreso: n={n}/{max_n} | OEIS: {len(encontrados_oeis)}/91 | T: {elapsed:.1f}s")
                sys.stdout.flush()

            for m in range(_sage_const_1 , n):
                # Operador k=3
                area = n * (n - m) * (_sage_const_2 *n - m) * (_sage_const_3 *n - m)
                sf = squarefree_part(area)
                
                if sf not in db_hallazgos:
                    ratio = float(m)/n
                    es_oeis = sf in oeis_91
                    db_hallazgos.add(sf)
                    
                    if es_oeis:
                        encontrados_oeis.add(sf)
                        ratios_hallados.append(ratio)
                    
                    # Escribir y forzar guardado físico en disco
                    writer.writerow([sf, n, m, f"{ratio:.6f}", es_oeis])
                    f.flush() # <--- Crucial para no perder datos si se cierra

    # Estadísticas Finales
    total_time = time.time() - start_time
    print("\n" + "="*_sage_const_60 )
    print("RESUMEN DE RESULTADOS")
    print("-" * _sage_const_60 )
    print(f"Total N únicos hallados: {len(db_hallazgos)}")
    print(f"Cobertura OEIS: {len(encontrados_oeis)}/91")
    if ratios_hallados:
        print(f"Ratio m/n Promedio (OEIS): {sum(ratios_hallados)/len(ratios_hallados):.4f}")
        print(f"Ratio m/n Máximo (OEIS): {max(ratios_hallados):.4f}")
        print(f"Ratio m/n Mínimo (OEIS): {min(ratios_hallados):.4f}")
    print(f"Tiempo Total: {total_time/_sage_const_60 :.2f} minutos")
    print("="*_sage_const_60 )

# Ejecución
barrido_gigante_k3_resistente(_sage_const_10000 )

